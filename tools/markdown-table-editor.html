<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Markdown Table Editor - Cohesion</title>
    <link rel="shortcut icon" href="../cohesion/favicon.svg" type="image/x-icon" />
    
    <!-- Primary Meta Tags -->
    <meta name="title" content="Markdown Table Editor - Cohesion">
    <meta name="description" content="Create and edit Markdown tables online with a clean and easy-to-use interface. Export your table instantly and try the Cohesion Markdown editor for free.">
    <meta name="keywords" content="markdown table generator, markdown table editor, online markdown table, create markdown tables, markdown table tool">
    <meta name="language" content="en">
    <meta name="author" content="Cohesion Team">
    <meta name="robots" content="index, follow">
    
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://flarom.github.io/cohesion/tools/markdown-table-editor">
    <meta property="og:title" content="Markdown Table Editor - Cohesion">
    <meta property="og:description" content="Free online Markdown table editor with instant preview. Build tables effortlessly and try the Cohesion Markdown editor.">
    <meta property="og:image" content="https://flarom.github.io/cohesion/cohesion/cards/tools.png">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://flarom.github.io/cohesion/tools/markdown-table-editor">
    <meta property="twitter:title" content="Markdown Table Editor - Cohesion">
    <meta property="twitter:description" content="Free online Markdown table editor with instant preview. Build tables effortlessly and try the Cohesion Markdown editor.">
    <meta property="twitter:image" content="https://flarom.github.io/cohesion/cohesion/cards/tools.png">

    <!-- Canonical URL -->
    <link rel="canonical" href="https://flarom.github.io/cohesion/tools/markdown-table-editor">

    <!-- PWA meta tags -->
    <meta name="application-name" content="Cohesion">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta content="#303030" name="theme-color" />
    <link rel="manifest" href="/manifest.json" />

    <link rel="preconnect" href="https://fonts.gstatic.com">

    <link rel="stylesheet" href="../style/palette.css">
    <link rel="stylesheet" href="../style/share.css">
    <link rel="stylesheet" href="../style/landing.css">
    <link rel="stylesheet" href="../style/prompts.css">

    <style>
        #table-editor {
            margin-bottom: 50px;
            overflow-x: scroll;
        }

        thead input {
            background: var(--background-color-3);
            color: var(--text-color);
            height: 35px;
            padding: 0px 20px;
            border: 1px solid var(--border-field-color);
            outline: none;
            border-radius: 5px;
        }
        
        tbody input {
            background: var(--background-color-2);
            color: var(--text-color);
            height: 35px;
            padding: 0px 20px;
            border: 1px solid var(--border-field-color);
            outline: none;
            border-radius: 5px;
        }

        thead th:first-child input {
            border-top-left-radius: 10px;
        }

        thead th:last-child input {
            border-top-right-radius: 10px;
        }

        tbody tr:last-child input:first-child {
            border-bottom-left-radius: 10px;
        }

        tbody tr:last-child input:last-child {
            border-bottom-right-radius: 10px;
        }

        .tools-td {
            opacity: 0;
            transition: opacity .1s;
        }

        tr:hover .tools-td {
            opacity: 1;
        }

        @media (max-width: 768px) {
            .tools-td {
                opacity: 1;
            }
        }

        .move-row-up {
            animation: moveRowUp .2s;
        }
        .move-row-down {
            animation: moveRowDown .2s;
        }
        @keyframes moveRowUp {
            0% { transform: translateY(0); }
            99.99% { transform: translateY(-100%); }
            100% { transform: translateY(0); }
        }
        @keyframes moveRowDown {
            0% { transform: translateY(0); }
            99.99% { transform: translateY(100%); }
            100% { transform: translateY(0); }
        }
        .move-col-left {
            animation: moveColLeft .2s;
        }
        .move-col-right {
            animation: moveColRight .2s;
        }
        @keyframes moveColLeft {
            0% { transform: translateX(0); }
            99.99% { transform: translateX(-100%); }
            100% { transform: translateX(0); }
        }
        @keyframes moveColRight {
            0% { transform: translateX(0); }
            99.99% { transform: translateX(100%); }
            100% { transform: translateX(0); }
        }
    </style>
</head>
<body class="theme-dark">
    <header>
        <div>
            <a href="../index.html" style="display: inline-flex; align-items: center; color: var(--text-color); text-decoration: none;">
                <img src="../cohesion/favicon.svg" alt="" width="48">
                <h2 translate="no" class="header-text">Cohesion</h2>
            </a>
        </div>
        <div style="display: flex; gap: 5px;">
            <button class="secondary hide-on-mobile" data-locale="dialogs.landing.header.editor" onclick="window.open('../app.html', '_self')">Editor</button>
            <button class="secondary hide-on-mobile" data-locale="dialogs.landing.header.tools" onclick="window.open('../tools.html', '_self')">Tools</button>
            <button class="secondary hide-on-mobile" data-locale="dialogs.landing.header.documentation" onclick="window.open('https://github.com/flarom/cohesion/wiki')">Documentation</button>
            <button class="secondary hide-on-mobile" data-locale="dialogs.landing.header.github" onclick="window.open('https://github.com/flarom/cohesion')">GitHub</button>
            <button class="secondary" onclick="changeTheme();" style="font-size: large;" translate="no"><span class="icon">routine</span></button>
            <button class="secondary hide-on-pc" onclick="handleMoreMenu();" style="font-size: large;" translate="no"><span class="icon">more_vert</span></button>
        </div>
    </header>

<section class="main" style="max-width: 1200px; margin: 0 auto; margin-top: 100px; ">
    <div>
        <button onclick="addRow()" class="text-button">Add row</button>
        <button onclick="addColumn()" class="text-button">Add colunm</button>
        <button onclick="copyMarkdown()" class="text-button">Copy markdown</button>
    </div>
    <div id="table-editor"></div>
    <div>
        <textarea id="markdown-output" style="width:90%;height:50vh; background-color: transparent; color:var(--text-color); border:none; outline:none;" readonly></textarea>
    </div>
    <script>
        let animationTimer = 50;

        let table = {
            headers: [
                { text: "", align: "center" },
                { text: "", align: "center" }
            ],
            rows: [
                ["", ""],
                ["", ""],
            ]
        };

        function renderTableEditor() {
        const container = document.getElementById('table-editor');
        container.innerHTML = '';
        const tableEl = document.createElement('table');
        // Header
        const thead = document.createElement('thead');
        const tr = document.createElement('tr');
        table.headers.forEach((header, colIdx) => {
            const th = document.createElement('th');
            // --- BEGIN: Controls on top ---
            const controlsDiv = document.createElement('div');
            controlsDiv.style.display = 'flex';
            controlsDiv.style.justifyContent = 'center';
            controlsDiv.style.gap = '2px';
            controlsDiv.style.marginBottom = '4px';

            // Align buttons
            const leftBtn = document.createElement('button');
            leftBtn.className = 'icon-button';
            leftBtn.textContent = 'align_horizontal_left';
            leftBtn.title = 'Align to the left';
            leftBtn.onclick = () => {
                table.headers[colIdx].align = 'left';
                renderTableEditor();
                updateMarkdown();
            };
            controlsDiv.appendChild(leftBtn);

            const centerBtn = document.createElement('button');
            centerBtn.className = 'icon-button';
            centerBtn.textContent = 'align_horizontal_center';
            centerBtn.title = 'Center';
            centerBtn.onclick = () => {
                table.headers[colIdx].align = 'center';
                renderTableEditor();
                updateMarkdown();
            };
            controlsDiv.appendChild(centerBtn);

            const rightBtn = document.createElement('button');
            rightBtn.className = 'icon-button';
            rightBtn.textContent = 'align_horizontal_right';
            rightBtn.title = 'Align to the right';
            rightBtn.onclick = () => {
                table.headers[colIdx].align = 'right';
                renderTableEditor();
                updateMarkdown();
            };
            controlsDiv.appendChild(rightBtn);

            // Column: move/rename
            const left = document.createElement('button');
            left.className = 'icon-button'
            left.textContent = 'arrow_left_alt';
            left.title = 'Move column left'
            left.disabled = colIdx === 0;
            left.onclick = () => moveColumn(colIdx, -1);
            controlsDiv.appendChild(left);
            const right = document.createElement('button');
            right.className = 'icon-button'
            right.textContent = 'arrow_right_alt';
            right.title = 'Move column right'
            right.disabled = colIdx === table.headers.length - 1;
            right.onclick = () => moveColumn(colIdx, 1);
            controlsDiv.appendChild(right);
            const rem = document.createElement('button');
            rem.className = 'icon-button'
            rem.textContent = 'remove';
            rem.title = 'Remove column'
            rem.disabled = table.headers.length <= 1;
            rem.onclick = () => removeColumn(colIdx);
            controlsDiv.appendChild(rem);

            th.appendChild(controlsDiv);
            // --- END: Controls on top ---

            const input = document.createElement('input');
            input.value = header.text;
            input.placeholder = `Column ${colIdx + 1}`;
            input.oninput = (e) => {
                table.headers[colIdx].text = e.target.value;
                updateMarkdown();
            };
            th.appendChild(input);

            tr.appendChild(th);
        });
        thead.appendChild(tr);
        tableEl.appendChild(thead);
            // Body
            const tbody = document.createElement('tbody');
            table.rows.forEach((row, rowIdx) => {
                const tr = document.createElement('tr');
                row.forEach((cell, colIdx) => {
                    const td = document.createElement('td');
                    const input = document.createElement('input');
                    input.value = cell;
                    input.placeholder = `Cell ${rowIdx + 1}, ${colIdx + 1}`;
                    input.oninput = (e) => {
                        table.rows[rowIdx][colIdx] = e.target.value;
                        updateMarkdown();
                    };
                    input.onfocus = (e) => {
                        // select all text on focus
                        setTimeout(() => input.select(), 0);
                    };
                    input.addEventListener('keydown', (e) => {
                        // navigation with tab and shift+tab
                        if (e.key === 'Tab') {
                            e.preventDefault();
                            let nextRow = rowIdx, nextCol = colIdx;
                            if (!e.shiftKey) {
                                // next cell
                                if (colIdx < table.headers.length - 1) {
                                    nextCol++;
                                } else if (rowIdx < table.rows.length - 1) {
                                    nextRow++;
                                    nextCol = 0;
                                }
                            } else {
                                // previous cell
                                if (colIdx > 0) {
                                    nextCol--;
                                } else if (rowIdx > 0) {
                                    nextRow--;
                                    nextCol = table.headers.length - 1;
                                }
                            }
                            const nextInput = document.querySelector(
                                `#table-editor tbody tr:nth-child(${nextRow + 1}) td:nth-child(${nextCol + 1}) input`
                            );
                            if (nextInput) {
                                nextInput.focus();
                            }
                        }
                        // alt+arrows to move rows and columns
                        if (e.altKey) {
                            if (e.key === 'ArrowLeft') {
                                e.preventDefault();
                                if (colIdx > 0) {
                                    moveColumn(colIdx, -1);
                                    setTimeout(() => {
                                        const movedInput = document.querySelector(
                                            `#table-editor tbody tr:nth-child(${rowIdx + 1}) td:nth-child(${colIdx}) input`
                                        );
                                        if (movedInput) movedInput.focus();
                                    }, animationTimer);
                                }
                            }
                            if (e.key === 'ArrowRight') {
                                e.preventDefault();
                                if (colIdx < table.headers.length - 1) {
                                    moveColumn(colIdx, 1);
                                    setTimeout(() => {
                                        const movedInput = document.querySelector(
                                            `#table-editor tbody tr:nth-child(${rowIdx + 1}) td:nth-child(${colIdx + 2}) input`
                                        );
                                        if (movedInput) movedInput.focus();
                                    }, animationTimer);
                                }
                            }
                            if (e.key === 'ArrowUp') {
                                e.preventDefault();
                                if (rowIdx > 0) {
                                    moveRow(rowIdx, -1);
                                    setTimeout(() => {
                                        const movedInput = document.querySelector(
                                            `#table-editor tbody tr:nth-child(${rowIdx}) td:nth-child(${colIdx + 1}) input`
                                        );
                                        if (movedInput) movedInput.focus();
                                    }, animationTimer);
                                }
                            }
                            if (e.key === 'ArrowDown') {
                                e.preventDefault();
                                if (rowIdx < table.rows.length - 1) {
                                    moveRow(rowIdx, 1);
                                    setTimeout(() => {
                                        const movedInput = document.querySelector(
                                            `#table-editor tbody tr:nth-child(${rowIdx + 2}) td:nth-child(${colIdx + 1}) input`
                                        );
                                        if (movedInput) movedInput.focus();
                                    }, animationTimer);
                                }
                            }
                        }
                        // Insert para adicionar coluna à direita
                        if (e.key === 'Insert' && !e.shiftKey) {
                            e.preventDefault();
                            table.headers.splice(colIdx + 1, 0, { text: ''/*"Column " + (table.headers.length + 1)*/, align: "center" });
                            table.rows.forEach(row => row.splice(colIdx + 1, 0, ''));
                            renderTableEditor();
                            updateMarkdown();
                            // Foca na nova célula
                            setTimeout(() => {
                                const newInput = document.querySelector(
                                    `#table-editor tbody tr:nth-child(${rowIdx + 1}) td:nth-child(${colIdx + 2}) input`
                                );
                                if (newInput) newInput.focus();
                            }, 0);
                        }
                        // Shift+Insert para adicionar linha abaixo
                        if (e.key === 'Insert' && e.shiftKey) {
                            e.preventDefault();
                            table.rows.splice(rowIdx + 1, 0, Array(table.headers.length).fill(''));
                            renderTableEditor();
                            updateMarkdown();
                            // Foca na célula correspondente da nova linha
                            setTimeout(() => {
                                const newInput = document.querySelector(
                                    `#table-editor tbody tr:nth-child(${rowIdx + 2}) td:nth-child(${colIdx + 1}) input`
                                );
                                if (newInput) newInput.focus();
                            }, 0);
                        }
                    });
                    td.appendChild(input);
                    tr.appendChild(td);
                });
                // Line: move/remove
                const td = document.createElement('td');
                td.className = 'tools-td'
                const up = document.createElement('button');
                up.className = 'icon-button';
                up.textContent = 'arrow_upward_alt';
                up.title = 'Move line upward';
                up.disabled = rowIdx === 0;
                up.onclick = () => moveRow(rowIdx, -1);
                td.appendChild(up);
                const down = document.createElement('button');
                down.className = 'icon-button';
                down.textContent = 'arrow_downward_alt';
                down.title = 'Move line downward'
                down.disabled = rowIdx === table.rows.length - 1;
                down.onclick = () => moveRow(rowIdx, 1);
                td.appendChild(down);
                const rem = document.createElement('button');
                rem.className = 'icon-button';
                rem.textContent = 'remove';
                rem.title = 'Remove row';
                rem.disabled = table.rows.length <= 1;
                rem.onclick = () => removeRow(rowIdx);
                td.appendChild(rem);
                tr.appendChild(td);
                tbody.appendChild(tr);
            });
            tableEl.appendChild(tbody);
            container.appendChild(tableEl);
        }

        function addRow() {
            table.rows.push(Array(table.headers.length).fill(''));
            renderTableEditor();
            updateMarkdown();
        }
        function removeRow(idx) {
            if(table.rows.length > 1) {
                table.rows.splice(idx, 1);
                renderTableEditor();
                updateMarkdown();
            }
        }
        function moveRow(idx, dir) {
            const newIdx = idx + dir;
            if (newIdx >= 0 && newIdx < table.rows.length) {
                // Add animation classes
                const tbody = document.querySelector('#table-editor tbody');
                if (tbody) {
                    const trs = tbody.querySelectorAll('tr');
                    if (trs[idx]) trs[idx].classList.add(dir < 0 ? 'move-row-up' : 'move-row-down');
                    if (trs[newIdx]) trs[newIdx].classList.add(dir < 0 ? 'move-row-down' : 'move-row-up');
                }
                setTimeout(() => {
                    const temp = table.rows[idx];
                    table.rows[idx] = table.rows[newIdx];
                    table.rows[newIdx] = temp;
                    renderTableEditor();
                    updateMarkdown();
                }, animationTimer);
            }
        }
        function addColumn() {
            table.headers.push({ text: ""/*"Column " + (table.headers.length+1)*/, align: "center" });
            table.rows.forEach(row => row.push(''));
            renderTableEditor();
            updateMarkdown();
        }
        function removeColumn(idx) {
            if(table.headers.length > 1) {
                table.headers.splice(idx, 1);
                table.rows.forEach(row => row.splice(idx, 1));
                renderTableEditor();
                updateMarkdown();
            }
        }
        function moveColumn(idx, dir) {
            const newIdx = idx + dir;
            if (newIdx >= 0 && newIdx < table.headers.length) {
                // Add animation classes
                const tableEl = document.querySelector('#table-editor table');
                if (tableEl) {
                    // Animate header
                    const ths = tableEl.querySelectorAll('thead th');
                    if (ths[idx]) ths[idx].classList.add(dir < 0 ? 'move-col-left' : 'move-col-right');
                    if (ths[newIdx]) ths[newIdx].classList.add(dir < 0 ? 'move-col-right' : 'move-col-left');
                    // Animate cells
                    const trs = tableEl.querySelectorAll('tbody tr');
                    trs.forEach(tr => {
                        const tds = tr.querySelectorAll('td');
                        if (tds[idx]) tds[idx].classList.add(dir < 0 ? 'move-col-left' : 'move-col-right');
                        if (tds[newIdx]) tds[newIdx].classList.add(dir < 0 ? 'move-col-right' : 'move-col-left');
                    });
                }
                setTimeout(() => {
                    const tempHeader = table.headers[idx];
                    table.headers[idx] = table.headers[newIdx];
                    table.headers[newIdx] = tempHeader;
                    table.rows.forEach(row => {
                        const tempCell = row[idx];
                        row[idx] = row[newIdx];
                        row[newIdx] = tempCell;
                    });
                    renderTableEditor();
                    updateMarkdown();
                }, animationTimer);
            }
        }
        function updateMarkdown() {
            const md = generateMarkdownTable(table);
            document.getElementById('markdown-output').value = md;
        }
        function generateMarkdownTable(table) {
            const colCount = table.headers.length;
            const allRows = [
                table.headers.map(h => h.text),
                ...table.rows
            ];
            const colWidths = [];
            for (let c = 0; c < colCount; c++) {
                let maxLen = 0;
                for (let r = 0; r < allRows.length; r++) {
                    const cell = (allRows[r][c] ?? '').toString();
                    if (cell.length > maxLen) maxLen = cell.length;
                }
                let alignSep = '';
                const align = table.headers[c].align;
                if (align === 'left') alignSep = ':---';
                else if (align === 'center') alignSep = ':---:';
                else if (align === 'right') alignSep = '---:';
                else alignSep = '---';
                if (alignSep.length > maxLen) maxLen = alignSep.length;
                colWidths[c] = maxLen;
            }

            function padCell(text, width, align) {
                text = text ?? '';
                const len = text.length;
                if (len >= width) return text;
                const diff = width - len;
                if (align === 'right') return ' '.repeat(diff) + text;
                if (align === 'center') {
                    const left = Math.floor(diff / 2);
                    const right = diff - left;
                    return ' '.repeat(left) + text + ' '.repeat(right);
                }
                return text + ' '.repeat(diff);
            }

            const headerRow = '| ' + table.headers.map((h, i) => padCell(h.text, colWidths[i], h.align)).join(' | ') + ' |';

            const alignRow = '| ' + table.headers.map((h, i) => {
                let align = h.align;
                let sep = '';
                if (align === 'left') sep = ':' + '-'.repeat(colWidths[i] - 1);
                else if (align === 'center') {
                    if (colWidths[i] < 3) sep = ':--:';
                    else sep = ':' + '-'.repeat(colWidths[i] - 2) + ':';
                }
                else if (align === 'right') sep = '-'.repeat(colWidths[i] - 1) + ':';
                else sep = '-'.repeat(colWidths[i]);
                return sep;
            }).join(' | ') + ' |';

            const rows = table.rows.map(row =>
                '| ' + row.map((cell, i) => padCell(cell.replace(/\|/g, '\\|'), colWidths[i], table.headers[i].align)).join(' | ') + ' |'
            );
            return [headerRow, alignRow, ...rows].join('\n');
        }

        function copyMarkdown() {
            var copyText = document.getElementById("markdown-output");

            copyText.select();
            copyText.setSelectionRange(0, 99999); // mobile

            navigator.clipboard.writeText(copyText.value);
        }

        renderTableEditor();
        updateMarkdown();
    </script>
</section>
    
    <script src="../script/settings.js"></script>
    <script src="../script/prompts.js"></script>
    <script>
        // load settings
        function loadSettings(){
            const theme = Settings.getSetting("theme");
            if (theme) document.body.className = theme;

            const root = document.documentElement;

            const editorFont = Settings.getSetting("editorFont");
            const paragraphFont = Settings.getSetting("paragraphFont");
            const titleFont = Settings.getSetting("titleFont");

            if (editorFont) root.style.setProperty("--font-editor", editorFont);
            if (paragraphFont) root.style.setProperty("--font-text", paragraphFont);
            if (titleFont) root.style.setProperty("--font-title", titleFont);
        }

        async function handleMoreMenu() {
            const selection = await promptSelect("More options", ["Editor", "Tools", "Documentation", "GitHub"]);

            switch (selection) {
                case 0: window.open('../app.html', '_self'); break;
                case 1: window.open('../tools.html', '_self'); break;
                case 2: window.open('https://github.com/flarom/cohesion/wiki'); break;
                case 3: window.open('https://github.com/flarom/cohesion'); break;
            }
        }

        function changeTheme() {
            let current = Settings.getSetting('theme');
            if (current === 'theme-dark') {
                Settings.setSetting('theme', 'theme-light');
            } else {
                Settings.setSetting('theme', 'theme-dark');
            }
            loadSettings();
        }

        loadSettings();
    </script>
</body>
</html>