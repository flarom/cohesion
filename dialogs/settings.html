<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title>Settings</title>
        <style>
            button.ball {
                width: 64px;
                height: 64px;
                border-radius: 32px;
                cursor: pointer;
                border: 0;
                transition: border-radius 0.3s, filter 0.3s;
            }

            button.ball:hover {
                border-radius: 15px;
                filter: brightness(1.1);
            }

            button.ball.selected {
                outline: 2px solid var(--highlight-color);
                border: 4px solid var(--background-color-2);
                box-shadow: var(--shadow);
            }

            .setting select {
                max-width: 300px;
                margin-bottom: 0px;
                padding: 0px 20px;
                box-sizing: content-box;
            }

            .setting .infolink {
                font-size: small;
            }
        </style>
    </head>

    <body>
        <div class="settings-body">
            <div class="main-page">
                <div>
                    <h4 class="setting-group-title" data-locale="dialogs.settings.main.appearence">Appearence</h4>
                    <div class="setting top" style="gap: 10px; flex-wrap: wrap; justify-content: flex-start;">
                        <button id="theme-epaper" class="ball" data-locale="dialogs.settings.main.appearence.theme.epaper" style="background-color: #ffffff; color: #000000" onclick="Settings.setSetting('theme', 'theme-epaper');loadSettings(); updateSelectedTheme()">ePaper</button>
                        <button id="theme-light" class="ball" data-locale="dialogs.settings.main.appearence.theme.light" style="background-color: #ffffff; color: #3c3c3c" onclick="Settings.setSetting('theme', 'theme-light');loadSettings(); updateSelectedTheme()">Light</button>
                        <button id="theme-cream" class="ball" data-locale="dialogs.settings.main.appearence.theme.cream" style="background-color: #f5eacb; color: #4b3a25" onclick="Settings.setSetting('theme', 'theme-cream');loadSettings(); updateSelectedTheme()">Cream</button>
                        <button id="theme-nord" class="ball" data-locale="dialogs.settings.main.appearence.theme.nord" style="background-color: #2e3440; color: #d8dee9" onclick="Settings.setSetting('theme', 'theme-nord');loadSettings(); updateSelectedTheme()">Nord</button>
                        <button id="theme-dark" class="ball" data-locale="dialogs.settings.main.appearence.theme.dark" style="background-color: #303030; color: #dddddd" onclick="Settings.setSetting('theme', 'theme-dark');loadSettings(); updateSelectedTheme()">Dark</button>
                        <button id="theme-monokai" class="ball" data-locale="dialogs.settings.main.appearence.theme.monokai" style="background-color: #272822; color: #F8F8F2" onclick="Settings.setSetting('theme', 'theme-monokai');loadSettings(); updateSelectedTheme()">Monokai</button>
                        <button id="theme-gruvbox-dark" class="ball" data-locale="dialogs.settings.main.appearence.theme.gruvbox-dark" style="background-color: #282828; color: #d5c4a1" onclick="Settings.setSetting('theme', 'theme-gruvbox-dark');loadSettings(); updateSelectedTheme()">Gruvbox</button>
                        <button id="theme-oled" class="ball" data-locale="dialogs.settings.main.appearence.theme.oled" style="background-color: #000000; color: #888888" onclick="Settings.setSetting('theme', 'theme-oled');loadSettings(); updateSelectedTheme()">OLED</button>
                        <button id="theme-custom" class="ball" data-locale="dialogs.settings.main.appearence.theme.custom" style="background: conic-gradient(var(--quote-purple),var(--quote-blue),var(--quote-green),var(--quote-yellow),var(--quote-red),var(--quote-purple)); color: var(--background-color)" onclick="Settings.setSetting('theme', 'theme-custom');loadSettings(); updateSelectedTheme()">Custom</button>
                        <button id="theme-edit-custom" class="icon-button" onclick="editCustomTheme()" style="font-size: larger;" translate="no" title="Edit custom theme">edit</button>
                        <button id="theme-delete-custom" class="icon-button" onclick="deleteCustomTheme()" style="font-size: larger;" translate="no" title="Reset custom theme">refresh</button>
                    </div>
                    
                    <div class="setting">
                        <span class="switch-text" data-locale="dialogs.settings.main.appearence.fonts.editor-font">Editor font</span>
                        <input list="default-fonts" type="text" placeholder="Ubuntu Mono" id="fontEditor" oninput="Settings.setSetting('editorFont', this.value); loadSettings();" />
                    </div>
                    <div class="setting">
                        <span class="switch-text" data-locale="dialogs.settings.main.appearence.fonts.paragraph-font">Paragraph font</span>
                        <input list="default-fonts" type="text" placeholder="Ubuntu" id="fontParagraph" oninput="Settings.setSetting('paragraphFont', this.value); loadSettings();" />
                    </div>
                    <div class="setting bottom">
                        <span class="switch-text" data-locale="dialogs.settings.main.appearence.fonts.title-font">Title font</span>
                        <input list="default-fonts" type="text" placeholder="Ubuntu" id="fontTitle" oninput="Settings.setSetting('titleFont', this.value); loadSettings();" />
                    </div>
                    
                    <datalist id="default-fonts">
                        <option value="Ubuntu"></option>
                        <option value="Ubuntu Mono"></option>
                        <option value="Sans serif"></option>
                        <option value="Serif"></option>
                        <option value="Monospace"></option>
                        <option value="Cursive"></option>
                    </datalist>
                </div>

                <div>
                    <h4 class="setting-group-title" data-locale="dialogs.settings.main.language">Language</h4>
                    <div class="setting top">
                        <span class="switch-text" data-locale="dialogs.settings.main.language">Language</span>
                        <select id="language" onchange="Language.set(this.value)">
                            <option value="en">English</option>
                            <option value="pt-br">PortuguÃªs</option>
                        </select>
                    </div>
                    <div class="setting bottom">
                        <span style="display: flex; align-items: center; gap: 5px;"><span class="icon">info</span>
                        <a href="https://github.com/flarom/cohesion/wiki/Translating" class="infolink" data-locale="dialogs.settings.main.translating" target="_blank">Help translating Cohesion</a></span>
                    </div>
                </div>

                <div>
                    <h4 class="setting-group-title" data-locale="dialogs.settings.main.suggestions">Suggestions</h4>
                    <div class="setting top switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.suggestions.suggest-document-words">Suggest document words</span>
                        <label class="switch">
                            <input type="checkbox" id="editorSuggestDocWords" onchange="Settings.setSetting('editorSuggestDocWords', this.checked)" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.suggestions-suggest-emojis">Suggest emojis</span>
                        <label class="switch">
                            <input type="checkbox" id="editorSuggestEmojis" onchange="Settings.setSetting('editorSuggestEmojis', this.checked)" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.suggestions-suggest-resources">Suggest resources</span>
                        <label class="switch">
                            <input type="checkbox" id="editorSuggestResources" onchange="Settings.setSetting('editorSuggestResources', this.checked)" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting bottom switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.suggestions-suggest-slash-commands">Suggest slash commands</span>
                        <label class="switch">
                            <input type="checkbox" id="editorSuggestCommands" onchange="Settings.setSetting('editorSuggestCommands', this.checked)" />
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div>
                    <h4 class="setting-group-title" data-locale="dialogs.settings.main.behavior">Behavior</h4>
                    <div class="setting top switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.behavior.auto-close-brackets">Auto-close brackets</span>
                        <label class="switch">
                            <input type="checkbox" id="editorAutoCloseBrackets" onchange="Settings.setSetting('editorAutoCloseBrackets', this.checked); updateEditorSettings()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.behavior.auto-close-markdown-notation">Auto-close Markdown notation</span>
                        <label class="switch">
                            <input type="checkbox" id="editorAutoCloseMDNotation" onchange="Settings.setSetting('editorAutoCloseMDNotation', this.checked); updateEditorSettings()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting bottom switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.behavior.auto-close-ml-tags">Auto-close ML tags</span>
                        <label class="switch">
                            <input type="checkbox" id="editorAutoCloseTags" onchange="Settings.setSetting('editorAutoCloseTags', this.checked); updateEditorSettings()">
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting top switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.behavior.line-numbers">Line numbers</span>
                        <label class="switch">
                            <input type="checkbox" id="editorLineNumbers" onchange="Settings.setSetting('editorLineNumbers', this.checked); updateEditorSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.behavior.full-width">Full width</span>
                        <label class="switch">
                            <input type="checkbox" id="editorWidth" onchange="Settings.setSetting('editorWidth', this.checked); updateEditorSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting bottom switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.behavior.highlight-active-line">Highlight active line</span>
                        <label class="switch">
                            <input type="checkbox" id="editorHighlightActiveLine" onchange="Settings.setSetting('editorHighlightActiveLine', this.checked); updateEditorSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting top bottom switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.behavior.rtl-text-align">RTL text align</span>
                        <label class="switch">
                            <input type="checkbox" id="editorDirection" onchange="if (this.checked) {Settings.setSetting('editorDirection', 'rtl')} else {Settings.setSetting('editorDirection', 'ltr')} updateEditorSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div>
                    <h4 class="setting-group-title" data-locale="dialogs.settings.main.date-and-time">Date & Time</h4>
                    <div class="setting top" style="display: flex; align-items: center; gap: 10px; justify-content: start;">
                        <input type="text" id="editorDate" style="max-width: 100%;" value="%d/%m/%Y %H:%M" onchange="Settings.setSetting('dateFormat', this.value)" />
                        <button class="icon-button" translate="no" title="Reset" onclick="document.getElementById('editorDate').value='%d/%m/%Y %H:%M'; Settings.setSetting('dateFormat', document.getElementById('editorDate').value); document.getElementById('editorDate').focus();">refresh</button>
                        <button class="icon-button" translate="no" title="Remove" onclick="removeLastDateBlock()">backspace</button>
                    </div>
                    <div class="setting">
                        <div style="display: flex; gap: 15px; flex-wrap: wrap;">
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.date-and-time.day">Day</span>
                                <div style="display: flex; flex-wrap: nowrap; gap: 3px">
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%A')" id="dateTimeBtn2" title="Full weekday name (e.g., 'Sunday')" data-locale-attr="title:dialogs.settings.main.date-and-time.day.tooltip.btn2">%A</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%a')" id="dateTimeBtn1" title="Abbreviated weekday name (e.g., 'Sun' for Sunday)" data-locale-attr="title:dialogs.settings.main.date-and-time.day.tooltip.btn1">%a</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%d')" id="dateTimeBtn3" title="Day of the month with leading zero (01-31)" data-locale-attr="title:dialogs.settings.main.date-and-time.day.tooltip.btn3">%d</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%-d')" id="dateTimeBtn14" title="Day of the month without leading zero (1-31)" data-locale-attr="title:dialogs.settings.main.date-and-time.day.tooltip.btn14">%-d</button>
                                </div>
                            </div>
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.date-and-time.month">Month</span>
                                <div style="display: flex; flex-wrap: nowrap; gap: 3px">
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%B')" id="dateTimeBtn5" title="Full month name (e.g., 'September')" data-locale-attr="title:dialogs.settings.main.date-and-time.month.tooltip.btn5">%B</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%b')" id="dateTimeBtn4" title="Abbreviated month name (e.g., 'Sep' for September)" data-locale-attr="title:dialogs.settings.main.date-and-time.month.tooltip.btn4">%b</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%m')" id="dateTimeBtn6" title="Month as a number with leading zero (01-12)" data-locale-attr="title:dialogs.settings.main.date-and-time.month.tooltip.btn6">%m</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%-m')" id="dateTimeBtn15" title="Month as a number without leading zero (1-12)" data-locale-attr="title:dialogs.settings.main.date-and-time.month.tooltip.btn15">%-m</button>
                                </div>
                            </div>
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.date-and-time.year">Year</span>
                                <div style="display: flex; flex-wrap: nowrap; gap: 3px">
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%Y')" id="dateTimeBtn8" title="Full year with century (e.g., '2024')" data-locale-attr="title:dialogs.settings.main.date-and-time.year.tooltip.btn8">%Y</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%y')" id="dateTimeBtn7" title="Year without century, as two digits (e.g., '24' for 2024)" data-locale-attr="title:dialogs.settings.main.date-and-time.year.tooltip.btn7">%y</button>
                                </div>
                            </div>
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.date-and-time.hour">Hour</span>
                                <div style="display: flex; flex-wrap: nowrap; gap: 3px">
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%H')" id="dateTimeBtn9" title="Hour (24-hour clock) with leading zero (00-23)" data-locale-attr="title:dialogs.settings.main.date-and-time.hour.tooltip.btn9">%H</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%-H')" id="dateTimeBtn16" title="Hour (24-hour clock) without leading zero (0-23)" data-locale-attr="title:dialogs.settings.main.date-and-time.hour.tooltip.btn16">%-H</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%I')" id="dateTimeBtn10" title="Hour (12-hour clock) with leading zero (01-12)" data-locale-attr="title:dialogs.settings.main.date-and-time.hour.tooltip.btn10">%I</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%-I')" id="dateTimeBtn17" title="Hour (12-hour clock) without leading zero (1-12)" data-locale-attr="title:dialogs.settings.main.date-and-time.hour.tooltip.btn17">%-I</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%p')" id="dateTimeBtn11" title="AM or PM indicator" data-locale-attr="title:dialogs.settings.main.date-and-time.hour.tooltip.btn11">%p</button>
                                </div>
                            </div>
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.date-and-time.minute">Minute</span>
                                <div style="display: flex; flex-wrap: nowrap; gap: 3px">
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%M')" id="dateTimeBtn12" title="Minute with leading zero (00-59)" data-locale-attr="title:dialogs.settings.main.date-and-time.minute.tooltip.btn12">%M</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%-M')" id="dateTimeBtn18" title="Minute without leading zero (0-59)" data-locale-attr="title:dialogs.settings.main.date-and-time.minute.tooltip.btn18">%-M</button>
                                </div>
                            </div>
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.date-and-time.second">Second</span>
                                <div style="display: flex; flex-wrap: nowrap; gap: 3px">
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%S')" id="dateTimeBtn13" title="Second with leading zero (00-59)" data-locale-attr="title:dialogs.settings.main.date-and-time.second.tooltip.btn13">%S</button>
                                    <button class="text-button" translate="no" onclick="insertDateTimeOption('%-S')" id="dateTimeBtn19" title="Second without leading zero (0-59)" data-locale-attr="title:dialogs.settings.main.date-and-time.second.tooltip.btn19">%-S</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="setting bottom">
                        <span style="display: flex; align-items: center; gap: 5px;"><span class="icon">info</span>
                        <a href="https://github.com/flarom/cohesion/wiki/Time-Formatting" class="infolink" data-locale="dialogs.settings.main.date-and-time.learn-more" target="_blank">Learn more about date and time syntax</a></span>
                    </div>
                </div>
                <div>
                    <h4 class="setting-group-title" data-locale="dialogs.settings.main.document-metadata">Document metadata</h4>
                    <div class="setting top">
                        <button class="text-button" onclick="editEditorMeta();" data-locale="dialogs.settings.main.document-metadata.edit-metadata">Edit metadata</button>
                        <button class="icon-button" translate="no" title="Reset" onclick="resetEditorMeta();">refresh</button>
                    </div>
                    <div class="setting bottom">
                        <span style="display: flex; align-items: center; gap: 5px;"><span class="icon">info</span>
                        <a href="https://github.com/flarom/cohesion/wiki/Meta-Formatting" class="infolink" target="_blank" data-locale="dialogs.settings.main.document-metadata.learn-more">Learn more about the metadata syntax</a></span>
                    </div>
                    <div class="setting top bottom switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.document-metadata.editor-auto-meta">Automatically insert metadata block on new documents</span>
                        <label class="switch">
                            <input type="checkbox" id="editorAutoMeta" onchange="Settings.setSetting('editorAutoMeta', this.checked); loadSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>

                <div>
                    <h4 class="setting-group-title" data-locale="dialogs.settings.main.status-bar">Status bar</h4>
                    <div class="setting top switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.status-bar">Status bar</span>
                        <label class="switch">
                            <input type="checkbox" id="statusShow" onchange="Settings.setSetting('statusShow', this.checked); loadSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.status-bar.cursor-position">Cursor position</span>
                        <label class="switch">
                            <input type="checkbox" id="statusCursorPos" onchange="Settings.setSetting('statusCursorPos', this.checked); loadSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.status-bar.editor-mode">Editor mode</span>
                        <label class="switch">
                            <input type="checkbox" id="statusEditorMode" onchange="Settings.setSetting('statusEditorMode', this.checked); loadSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                    <div class="setting bottom switch-wrapper">
                        <span class="switch-text" data-locale="dialogs.settings.main.status-bar.document-size">Document size</span>
                        <label class="switch">
                            <input type="checkbox" id="statusDocumentSize" onchange="Settings.setSetting('statusDocumentSize', this.checked); loadSettings()" />
                            <span class="slider"></span>
                        </label>
                    </div>
                </div>
                <div>
                    <div>
                        <h4 class="setting-group-title" data-locale="dialogs.settings.main.backups" id="setting-data">Backups</h4>
                        <div class="setting top bottom switch-wrapper">
                            <span class="switch-text" data-locale="dialogs.settings.main.backups.backup-reminder">Monthly backup reminders</span>
                            <label class="switch">
                                <input type="checkbox" id="backupReminder" onchange="Settings.setSetting('backupReminder', this.checked); loadSettings()" />
                                <span class="slider"></span>
                            </label>
                        </div>

                        <div class="setting top">
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.backups.download-backup">Download backup</span>
                                <span class="switch-description" data-locale="dialogs.settings.main.backups.download-backup.description">Export your documents as a zip file</span>
                            </div>
                            <div>
                                <button class="text-button" onclick="exportBook();" data-locale="dialogs.settings.main.backups.export">Export</button>
                            </div>
                        </div>

                        <div class="setting">
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.backups.import-backup">Import backup</span>
                                <span class="switch-description" data-locale="dialogs.settings.main.backups.import-backup.description">Import documents from a zip file</span>
                            </div>
                            <div>
                                <button class="text-button" onclick="importBook();" data-locale="dialogs.settings.main.backups.import">Import</button>
                            </div>
                        </div>
                        
                        <div class="setting bottom">
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.backups.replace-with-backup">Replace with backup</span>
                                <span class="switch-description" data-locale="dialogs.settings.main.backups.replace-with-backup.description">Import documents from a zip file, replacing your files</span>
                            </div>
                            <div>
                                <button class="text-button danger" onclick="handleImportDeleteBook();" data-locale="dialogs.settings.main.backups.replace">Replace</button>
                            </div>
                        </div>

                        <div class="setting top bottom">
                            <div>
                                <span class="switch-text" data-locale="dialogs.settings.main.backups.delete-empty-files">Delete empty files</span>
                                <span class="switch-description" data-locale="dialogs.settings.main.backups.delete-empty-files.description">Delete all files without any text or meta</span>
                            </div>
                            <div>
                                <button class="text-button danger" onclick="handleDeleteEmptyFiles();" data-locale="dialogs.settings.main.backups.delete">Delete</button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script>
            (() => {
                // fonts
                const txtFontEditor = document.getElementById("fontEditor");
                const txtFontParagraph = document.getElementById("fontParagraph");
                const txtFontTitle = document.getElementById("fontTitle");
                txtFontEditor.value = Settings.getSetting("editorFont", "Ubuntu Mono");
                txtFontParagraph.value = Settings.getSetting("paragraphFont", "Ubuntu");
                txtFontTitle.value = Settings.getSetting("titleFont", "Ubuntu");

                // lang
                const selLanguage = document.getElementById("language");
                selLanguage.value = Settings.getSetting("language", 'en')

                // editor
                // const cbxEditorShowHints = document.getElementById("editorShowHints");
                const cbxEditorSuggestDocWords = document.getElementById("editorSuggestDocWords");
                const cbxEditorSuggestEmojis = document.getElementById("editorSuggestEmojis");
                const cbxEditorSuggestResources = document.getElementById("editorSuggestResources");
                const cbxEditorSuggestCommands = document.getElementById("editorSuggestCommands");
                const cbxEditorLineNumbers = document.getElementById("editorLineNumbers");
                const cbxEditorDirection = document.getElementById("editorDirection");
                const cbxEditorWidth = document.getElementById("editorWidth");
                const cbxEditorHighlightActiveLine = document.getElementById('editorHighlightActiveLine');
                const cbxEditorAutoCloseBrackets = document.getElementById('editorAutoCloseBrackets');
                const cbxEditorAutoCloseMDNotation = document.getElementById('editorAutoCloseMDNotation');
                const cbxEditorAutoCloseTags = document.getElementById('editorAutoCloseTags');
                const txtEditorDate = document.getElementById("editorDate");
                // if (Settings.getSetting("editorShowHints", "true") === "true") cbxEditorShowHints.checked = "true";
                if (Settings.getSetting("editorSuggestDocWords", "true") === "true") cbxEditorSuggestDocWords.checked = "true";
                if (Settings.getSetting("editorSuggestEmojis", "true") === "true") cbxEditorSuggestEmojis.checked = "true";
                if (Settings.getSetting("editorSuggestResources", "true") === "true") cbxEditorSuggestResources.checked = "true";
                if (Settings.getSetting("editorSuggestCommands", "true") === "true") cbxEditorSuggestCommands.checked = "true";
                if (Settings.getSetting("editorLineNumbers", "false") === "true") cbxEditorLineNumbers.checked = "true";
                if (Settings.getSetting("editorDirection", "ltr") === "rtl") cbxEditorDirection.checked = "true";
                if (Settings.getSetting("editorWidth", "false") === "true") cbxEditorWidth.checked = "true";
                if (Settings.getSetting("editorHighlightActiveLine", "true") === "true") cbxEditorHighlightActiveLine.checked = "true";
                if (Settings.getSetting("editorAutoCloseBrackets", "true") === "true") cbxEditorAutoCloseBrackets.checked = "true";
                if (Settings.getSetting("editorAutoCloseMDNotation", "true") === "true") cbxEditorAutoCloseMDNotation.checked = "true";
                if (Settings.getSetting("editorAutoCloseTags", "false") === "true") cbxEditorAutoCloseTags.checked = "true";
                txtEditorDate.value = Settings.getSetting("dateFormat", "%d/%m/%Y %H:%M");

                // status bar
                const cbxStatusShow = document.getElementById("statusShow");
                const cbxStatusCursorPos = document.getElementById("statusCursorPos");
                const cbxStatusEditorMode = document.getElementById("statusEditorMode");
                const cbxStatusDocumentSize = document.getElementById("statusDocumentSize");
                if (Settings.getSetting("statusShow", "true") === "true") cbxStatusShow.checked = "true";
                if (Settings.getSetting("statusCursorPos", "true") === "true") cbxStatusCursorPos.checked = "true";
                if (Settings.getSetting("statusEditorMode", "true") === "true") cbxStatusEditorMode.checked = "true";
                if (Settings.getSetting("statusDocumentSize", "true") === "true") cbxStatusDocumentSize.checked = "true";

                document.getElementById("dateTimeBtn1").innerHTML = strftime("%a");
                document.getElementById("dateTimeBtn2").innerHTML = strftime("%A");
                document.getElementById("dateTimeBtn3").innerHTML = strftime("%d");
                document.getElementById("dateTimeBtn4").innerHTML = strftime("%b");
                document.getElementById("dateTimeBtn5").innerHTML = strftime("%B");
                document.getElementById("dateTimeBtn6").innerHTML = strftime("%m");
                document.getElementById("dateTimeBtn7").innerHTML = strftime("%y");
                document.getElementById("dateTimeBtn8").innerHTML = strftime("%Y");
                document.getElementById("dateTimeBtn9").innerHTML = strftime("%H");
                document.getElementById("dateTimeBtn10").innerHTML = strftime("%I");
                document.getElementById("dateTimeBtn11").innerHTML = strftime("%p");
                document.getElementById("dateTimeBtn12").innerHTML = strftime("%M");
                document.getElementById("dateTimeBtn13").innerHTML = strftime("%S");
                document.getElementById("dateTimeBtn14").innerHTML = strftime("%-d");
                document.getElementById("dateTimeBtn15").innerHTML = strftime("%-m");
                document.getElementById("dateTimeBtn16").innerHTML = strftime("%-H");
                document.getElementById("dateTimeBtn17").innerHTML = strftime("%-I");
                document.getElementById("dateTimeBtn18").innerHTML = strftime("%-M");
                document.getElementById("dateTimeBtn19").innerHTML = strftime("%-S");

                // meta
                const cbxEditorAutoMeta = document.getElementById('editorAutoMeta');
                if (Settings.getSetting('editorAutoMeta', 'false') === 'true') cbxEditorAutoMeta.checked = 'true';

                // backups
                const cbxBackupReminder = document.getElementById("backupReminder");
                if (Settings.getSetting("backupReminder", "true") === "true") cbxBackupReminder.checked = "true";
            })();

            function insertDateTimeOption(block) {
                const txtEditorDate = document.getElementById("editorDate");
                let value = txtEditorDate.value;

                txtEditorDate.value = value + block;
                txtEditorDate.focus();
                Settings.setSetting("dateFormat", txtEditorDate.value);
            }

            function removeLastDateBlock() {
                const input = document.getElementById("editorDate");
                let value = input.value;

                const lastPercentIndex = value.lastIndexOf("%");

                if (lastPercentIndex !== -1) {
                    value = value.substring(0, lastPercentIndex);
                } else {
                    value = "";
                }

                input.value = value;
                input.focus();
                Settings.setSetting("dateFormat", value);
            }

            async function handleDeleteEmptyFiles() {
                if (await promptConfirm("Are you sure you want to delete empty files?", true)) {
                    deleteEmptyFiles();
                }
            }

            async function handleImportDeleteBook() {
                if (await promptConfirm("Are you sure you want to replace your documents? This action can not be reverted.", true)) {
                    importDeleteBook();
                }
            }

            function editEditorMeta() {
                const defaultMeta = 
`title:       ~{1:\${getFileTitle(index) || "New document"}}
project:     ~{2:Documents}
description: ~{3:No description provided}
tags:        ~{4:Uncategorized}
author:      ~{5:Author name}
date:        ~{6:\${strftime(Settings.getSetting("dateFormat", "%Y/%m/%d %H:%M"))}}
icon:        ~{7:ðŸ“„}
banner:      ~{8:cohesion/banners/1.png}
#language:   ~{9:Blank}
#license:    ~{10:Blank}
#source:     ~{11:Blank}`;
                const savedMeta = Settings.getSetting('editorMeta', defaultMeta);
                promptCodeEditor(savedMeta).then(newValue => {
                    if (typeof newValue === 'string' && newValue !== '') {
                        Settings.setSetting('editorMeta', newValue);
                    }
                });
            }

            async function resetEditorMeta() {
                if(await promptConfirm('Reset custom editor meta?', true)) {
                    Settings.removeSetting('editorMeta');
                }
            }

            updateSelectedTheme();

            function updateSelectedTheme() {
                const theme = Settings.getSetting("theme", "theme-dark");
                document.querySelectorAll("button.ball").forEach(btn => btn.classList.remove("selected"));
                const selectedBtn = document.getElementById(theme);
                const editCustomBtn = document.getElementById('theme-edit-custom');
                const deleteCustomBtn = document.getElementById('theme-delete-custom');
                if (selectedBtn) selectedBtn.classList.add("selected");
                if (selectedBtn.id == 'theme-custom') { editCustomBtn.style.display = 'block'; deleteCustomBtn.style.display = 'block'; }
                else { editCustomBtn.style.display = 'none'; deleteCustomBtn.style.display = 'none'; } 
            }

            async function editCustomTheme() {
                const defaultTheme = 
`/**
 * This file controls the colors and styles of the "Custom" theme.
 * Each line defines a CSS variable used by the app to style different parts
 * of the interface.
 * 
 * HOW IT WORKS:
 * - Every variable starts with two dashes (--) and defines a color or
 *   a visual property.
 * - After editing, the theme updates automatically when you select
 *   "Custom" in the settings.
 * - You can use color formats like HEX (#ff00ff), RGB (rgb(255,0,255)),
 *   HSL (hsl(300, 100%, 50%)), or OKLab/OKLCH (oklab(50% 0.1 0.2)).
 *
 * Quick example:
 * --background-color: #202020;    (Main background color)
 * --text-color: #e0e0e0;          (Text color)
 * --highlight-color: #3584e4;     (Accent color)
 * 
 * You can also write custom CSS instructions at the end of the document.
 * Feel free to delete this comment
 *
 * Have fun customizing your look!
 */

/** Accent color */
--highlight-color:      #3584e4; 

/** Background colors */
--background-color:     #161616;
--background-color-2:   #222222;
--background-color-3:   #2e2e2e;

/** Text colors */
--text-color:           #cccccc;
--title-color:          #dddddd;
--button-color:         #ffffff;
--button-color-2:       #ffffff;

/** Borders */
--border-dark-color:    #000000;
--border-light-color:   #636363;
--border-field-color:   transparent;

/** Misc */
--active-line:          #222222; /* Cursor active line on the editor */
--field-color:          #2e2e2e; /* Fields background color, on settings page and forms */
--hover-color:          #2e2e2e; /* Button hover background color */
--selection-color:      #3584e433; /* Text selection color */
--link-color:           #99c1f1; /* Hyperlinks color */
--danger:               #ff8881; /* Dangerous action text color */
--danger-bg:            #ff888133; /* Dangerous action background color */
--shadow:               0px 0px 10px #00000055;
    
/** Admonitions, graphs */
--quote-purple:         #dd92ff; 
--quote-blue:           #818eff;
--quote-green:          #9aff81; 
--quote-yellow:         #fff781;
--quote-red:            #ff8881;

--quote-purple-bg:      #3d2b45; 
--quote-blue-bg:        #2b2e42;
--quote-green-bg:       #30452b; 
--quote-yellow-bg:      #45432b;
--quote-red-bg:         #452d2b;

/** Codeblocks */
--hljs-bg:              #23272e;
--hljs-text:            #e0e0e0;
--hljs-comment:         #6a9955;
--hljs-keyword:         #569cd6;
--hljs-function:        #dcdcaa;
--hljs-string:          #ce9178;
--hljs-number:          #b5cea8;
--hljs-variable:        #9cdcfe;
--hljs-title:           #4ec9b0;
--hljs-link:            #d7ba7d;
--hljs-positive:        #b5cea8;
--hljs-positive-bg:     #b5cea833;
--hljs-negative:        #f44747;
--hljs-negative-bg:     #f4474733;

/** Write your custom CSS here */
`;

                const saved = Settings.getSetting("theme-custom-value", defaultTheme);

                const newValue = await promptCodeEditor(saved);

                if (typeof newValue === "string" && newValue.trim() !== "") {
                    Settings.setSetting("theme-custom-value", newValue.trim());
                    if (Settings.getSetting("theme") === "theme-custom") {
                        applyCustomTheme(newValue.trim());
                    }
                }
            }

            async function deleteCustomTheme(){
                if(await promptConfirm('Reset custom theme?', true)) {
                    Settings.removeSetting('theme-custom-value');
                }
            }

            cacheOriginalContent();
            cacheOriginalAttributes();
            applyLanguage();
        </script>
    </body>
</html>