<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Document</title>

  <style>
    h3.app-name {
      margin: 8px 0 4px 0;
      font-weight: 500;
    }

    p.version {
      background-color: var(--quote-blue-bg);
      color: var(--quote-blue);
      font-weight: bold;
      display: inline-block;
      padding: 2px 12px;
      border-radius: 999px;
      margin-top: 0px;
    }

    .settings-body {
      padding: 0px 16px;
      animation: fadein 0.3s ease;
    }

    @keyframes fadein {
      from { opacity: 0; transform: translateY(8px); }
      to { opacity: 1; transform: translateY(0); }
    }
  </style>
</head>
<body>
  <div class="center" style="padding: 10px; text-align:center;">
    <img src="cohesion/favicon.svg" alt="" style="transform: scale(0); animation: showdialog 1s ease-in-out forwards;">
    <h3 translate="no" class="app-name">Cohesion</h3>
    <p translate="no" class="version" onclick="copyVersion(this)">OwO</p>
  </div>

  <div class="settings-body" id="settingsBody">
    <div class="main-page">
      <div class="setting top bottom" style="cursor: pointer;" onclick="window.open('index.html?intro=true')">
        <span class="switch-text">Landing page</span>
        <button class="icon-button">open_in_new</button>
      </div>
      <div class="setting top bottom" style="cursor: pointer;" onclick="window.open('https://github.com/flarom/cohesion/issues')">
        <span class="switch-text">Report an Issue</span>
        <button class="icon-button">open_in_new</button>
      </div>
      <div class="setting top" style="cursor: pointer;" onclick="showPage('credits')">
        <span class="switch-text">Credits</span>
        <button class="icon-button">chevron_forward</button>
      </div>
      <div class="setting bottom" style="cursor: pointer;" onclick="showPage('legal')">
        <span class="switch-text">Legal</span>
        <button class="icon-button">chevron_forward</button>
      </div>
    </div>
  </div>

  <script>
    (() => {
        const settingsBody = document.getElementById('settingsBody');
    })();

    function showMainPage() {
        settingsBody.innerHTML = `
            <div class="main-page">
            <div class="setting top bottom" style="cursor: pointer;" onclick="window.open('index.html?intro=true')">
                <span class="switch-text">Landing page</span>
                <button class="icon-button">open_in_new</button>
            </div>
            <div class="setting top bottom" style="cursor: pointer;" onclick="window.open('https://github.com/flarom/cohesion/issues')">
                <span class="switch-text">Report an Issue</span>
                <button class="icon-button">open_in_new</button>
            </div>
            <div class="setting top" style="cursor: pointer;" onclick="showPage('credits')">
                <span class="switch-text">Credits</span>
                <button class="icon-button">chevron_forward</button>
            </div>
            <div class="setting bottom" style="cursor: pointer;" onclick="showPage('legal')">
                <span class="switch-text">Legal</span>
                <button class="icon-button">chevron_forward</button>
            </div>
            </div>
        `;
    }

    function showPage(type) {
        if (type === 'credits') {
            settingsBody.innerHTML = `
            <div class="main-page">
                <div class="setting top bottom" style="cursor: pointer;" onclick="showMainPage()">
                    <span>
                        <span class="icon">arrow_back</span>
                        Back
                    </span>
                </div>
                <h4>Libraries</h4>
                <div class="setting top bottom">
                    <ul>
                        <li><a href='https://codemirror.net/' target='_blank'>CodeMirror</a> — Text editor</li>
                        <li><a href='https://showdownjs.com/' target='_blank'>ShowdownJS</a> — Markdown parser</li>
                        <li><a href='https://stuk.github.io/jszip/' target='_blank'>JSZip</a> — Compressor</li>
                        <li><a href='https://ekoopmans.github.io/html2pdf.js/' target='_blank'>html2pdf.js</a> — PDF export</li>
                        <li><a href='https://highlightjs.org/' target='_blank'>Highlight.js</a> — Syntax highlighting</li>
                    </ul>
                </div>
                <h4>Graphics</h4>
                <div class="setting top bottom">
                    <ul>
                        <li><a href='https://fonts.google.com/icons' target='_blank'>Google Material Icons</a> — Symbolic icons</li>
                        <li><a href='https://github.com/PapirusDevelopmentTeam/papirus-icon-theme/' target='_blank'>Papirus Icons</a> — Colored icons</li>
                    </ul>
                </div>
                <h4>General inspiration</h4>
                <div class="setting top bottom">
                    <ul>
                        <li><a href='https://apps.gnome.org/TextEditor/' target='_blank'>GNOME Text Editor</a> — Original app icon</li>
                        <li><a href='https://apps.gnome.org/Apostrophe/' target='_blank'>Apostrophe</a> — Layout and design</li>
                        <li><a href='https://developer.gnome.org/hig/' target='_blank'>GNOME Human Interface Guidelines</a> — Design guidelines</li>
                    </ul
                </div>
            </div>
            `;
        }

        if (type === 'legal') {
            settingsBody.innerHTML = `
            <div class="main-page">
                <div class="setting top bottom" style="cursor: pointer;" onclick="showMainPage()">
                    <span>
                        <span class="icon">arrow_back</span>
                        Back
                    </span>
                </div>
                <div class="setting top bottom">
                    <div>
                        <p>Copyright (C) ${new Date().getFullYear()}, Flarom.</p>
                        <p>This application comes with absolutely no warranty. It is licensed under the <a href='https://www.gnu.org/licenses/gpl-3.0.html' target='_blank'>GNU GPL v3</a>.</p>
                    </div>
                </div>
            </div>
            `;
        }
    }

    async function updateVersionLabel() {
        const versionLabel = document.querySelector('.version');

        function timeAgo(dateString) {
        const now = new Date();
        const then = new Date(dateString);
        const seconds = Math.floor((now - then) / 1000);

        const intervals = [
            { label: 'year', seconds: 31536000 },
            { label: 'month', seconds: 2592000 },
            { label: 'day', seconds: 86400 },
            { label: 'hour', seconds: 3600 },
            { label: 'minute', seconds: 60 },
        ];

        for (const i of intervals) {
            const count = Math.floor(seconds / i.seconds);
            if (count >= 1) return `${count} ${i.label}${count > 1 ? 's' : ''} ago`;
        }

        return 'just now';
        }

        try {
        const response = await fetch('https://api.github.com/repos/flarom/cohesion/commits/main');
        if (!response.ok) throw new Error('Failed to fetch commit info');

        const data = await response.json();
        console.log(data);
        const sha = data.sha.substring(0, 7);
        const author = data.commit.author.name;
        const committer = data.commit.committer.name;
        const message = data.commit.message.split('\n')[0];
        const date = data.commit.committer.date;

        versionLabel.textContent = `${sha}`;
        versionLabel.title = `"${message}"\nauthored by ${author} • committed by ${committer} ${timeAgo(date)}`;
        } catch (error) {
        console.error('Error fetching version info:', error);
        versionLabel.textContent = 'version unknown';
        versionLabel.title = 'Failed to fetch commit data';
        }
    }

    function copyVersion(el) {
        navigator.clipboard.writeText(el.textContent.trim())
        .then(() => showToast('Copied to clipboard', 'content_copy'))
        .catch(err => console.error('Copy failed:', err));
    }

    updateVersionLabel();
  </script>
</body>
</html>
